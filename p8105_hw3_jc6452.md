Homework 3
================

# Problem 1

## importing data and cleaning up

``` r
data("ny_noaa")

ny_noaa %>% 
  count(snow) %>%
  arrange(desc(n))
```

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <int>   <int>
    ##  1     0 2008508
    ##  2    NA  381221
    ##  3    25   31022
    ##  4    13   23095
    ##  5    51   18274
    ##  6    76   10173
    ##  7     8    9962
    ##  8     5    9748
    ##  9    38    9197
    ## 10     3    8790
    ## # ℹ 272 more rows

``` r
ny_noaa = 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))
```

``` r
ny_noaa %>% 
  group_by(id, year, month) %>% 
  filter(month %in% c(1, 7)) %>% 
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) %>% 
  ggplot(aes(x = year, y = mean_tmax, group = id)) + geom_point() + geom_path() +
  facet_grid(~month) +
  labs(title = "Mean monthly temperature for each station across years for January and July")
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

<img src="p8105_hw3_jc6452_files/figure-gfm/unnamed-chunk-3-1.png" width="90%" />

``` r
hex = 
  ny_noaa %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex()

ridge = 
  ny_noaa %>% 
  filter(snow < 100, snow > 0) %>%
  ggplot(aes(x = snow, y = as.factor(year))) + 
  geom_density_ridges()

hex + ridge
```

    ## Picking joint bandwidth of 3.76

<img src="p8105_hw3_jc6452_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

# Problem 2

## importing data and cleaning up

``` r
participant = read_csv("data/participant.csv", skip = 4) %>% 
  janitor::clean_names() %>% 
  mutate(
    sex = case_match(
      sex,
      1 ~ "male",
      2 ~ "female"),
    education = case_match(
      education,
      1 ~ "Less than high school",
      2 ~ "High school equivalent",
      3 ~ "More than high school"
    ),
    education = as.factor(education)
  )
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accelerometer = read_csv("data/accelerometer.csv",) %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    cols = min1:min1440,
    names_to = "time_elasped",
    names_transform = list(time_elasped = as.integer),
    values_to = "mims",
    names_prefix = "min"
  )
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
study = left_join(participant, accelerometer, by = "seqn") %>% 
  filter(age >= 21) %>% 
  drop_na(education)
```

``` r
participant %>%
  drop_na(education) %>% 
  count(sex, education)
```

    ## # A tibble: 6 × 3
    ##   sex    education                  n
    ##   <chr>  <fct>                  <int>
    ## 1 female High school equivalent    23
    ## 2 female Less than high school     29
    ## 3 female More than high school     59
    ## 4 male   High school equivalent    37
    ## 5 male   Less than high school     28
    ## 6 male   More than high school     56

``` r
#Female Age Distribution
participant %>% drop_na(education) %>% 
  ggplot(aes(x= age, fill = sex)) +
  facet_grid(.~education) +
  geom_histogram(bins = 6, position = "dodge")+ 
  labs(title = "Age distributions for male and female in each education category")
```

<img src="p8105_hw3_jc6452_files/figure-gfm/sex-1.png" width="90%" />
Based on the plot above, females in the 40 to have the greatest number
of people that had more than high school level education. Generally,
males demonstrate to have had greatest number of more than high school
level education up until 60. After 60 age group, the general education
level tends to decrease with greater number of both female and male
population who had less than high school level education. Overall, the
younger generation definitely seemed to be more invested in the level of
education with trend of higher education decreasing as the age
increases.

``` r
total_activity = study %>% 
  group_by(seqn, sex, age, education) %>% 
  summarize(
    total_activity = sum(mims))
```

    ## `summarise()` has grouped output by 'seqn', 'sex', 'age'. You can override
    ## using the `.groups` argument.

``` r
total_activity %>% 
ggplot(aes(x = age, y = total_activity, color = sex))+
  facet_grid(.~education) +
  geom_smooth(se = FALSE)+
  geom_point()+ 
  labs(title = "Total Activities vs Age",
       x = "Age",
       y = "Total Activities",
       color = "Education") +
  viridis::scale_color_viridis(discrete = TRUE) + 
  theme_minimal() + 
  theme(legend.position = "bottom")
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

<img src="p8105_hw3_jc6452_files/figure-gfm/unnamed-chunk-6-1.png" width="90%" />
Based on the plot above, I can observe that there is an overall
decreasing total for all education level as age increases. Though one
thing to note is that group with less than high school level education
has the greatest total activities to begin with for both sex around age
20.

``` r
study %>% 
  ggplot(aes(x = time_elasped/60, y= mims, color = sex)) +
  geom_point(alpha = 0.5) +
  geom_smooth(aes(group = sex),se = FALSE) +
  facet_grid(.~education) +
  labs(title = 'More than high school level education',
       x = 'Time (hour) ', 
       y = 'Activity',
       color = 'Sex') +
  theme(legend.position = "bottom")
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

<img src="p8105_hw3_jc6452_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />
The trend as seen via the smooth line demonstrates to be similar cross
all three panels: There is an increase in the activity after 5 hours
have elapsed and peaks around 10-12 hour. The acitivty slowly decreases
after hour 20. While the “High school equivalent” and “Less than high
school” education groups show similar patterns individually, the “more
than high school” group shows some variability. Especially noting the
predominantly female peak activity between hour 5-7 and predominantly
male peak activity from hour 20-22 (8-10pm).

## Problem 3

``` r
Jan2020 = read_csv("data/citibike/Jan 2020 Citi.csv.zip") %>% 
  janitor::clean_names() %>% 
  mutate(
    date = "Jan 2020"
  )

Jan2024 = read_csv("data/citibike/Jan 2024 Citi.csv.zip") %>% 
  janitor::clean_names() %>% 
  mutate(
    date = "Jan 2024"
  )

July2020 = read_csv("data/citibike/July 2020 Citi.csv.zip") %>% 
  janitor::clean_names() %>% 
  mutate(
    date = "July 2020"
  )

July2024 = read_csv("data/citibike/July 2024 Citi.csv.zip") %>% 
  janitor::clean_names() %>% 
  mutate(
    date = "July 2024"
  )
```

``` r
citi = bind_rows(
  Jan2020, Jan2024, July2020, July2024
)
```

``` r
citi %>% 
  count(date, member_casual) %>% 
  knitr::kable()
```

| date      | member_casual |     n |
|:----------|:--------------|------:|
| Jan 2020  | casual        |   984 |
| Jan 2020  | member        | 11436 |
| Jan 2024  | casual        |  2108 |
| Jan 2024  | member        | 16753 |
| July 2020 | casual        |  5637 |
| July 2020 | member        | 15411 |
| July 2024 | casual        | 10894 |
| July 2024 | member        | 36262 |

Based on the table above, we can see that Citi Bike members are taking
the ride more frequently overall. However, there has been a drastic
increase in both casual and member riders in July 2024 compared to other
dates, almost double the number from July 2020.

### 5 most popular starting stations for July 2024

``` r
citi %>% 
  filter(date == "July 2024") %>% 
  count(start_station_name) %>% 
  arrange(desc(n)) %>% 
  head(5) %>% 
  knitr::kable()
```

| start_station_name       |   n |
|:-------------------------|----:|
| Pier 61 at Chelsea Piers | 163 |
| University Pl & E 14 St  | 155 |
| W 21 St & 6 Ave          | 152 |
| West St & Chambers St    | 150 |
| W 31 St & 7 Ave          | 146 |

### separating month and year

``` r
citi = citi %>% 
  separate(date, c('month', 'year'), sep = " ", remove = TRUE)
```

### aggregating by the different weekdays, month and year

``` r
citi_effect = citi %>% 
  group_by(weekdays, month, year) %>% 
  summarise(
    median_duration = median(duration, na.rm = TRUE)
  ) %>% 
  mutate(
    weekdays = factor(weekdays,
    levels = c("Monday", "Tuesday","Wednesday", "Thursday", "Friday", "Saturday", "Sunday"),
    ordered = TRUE))
```

    ## `summarise()` has grouped output by 'weekdays', 'month'. You can override using
    ## the `.groups` argument.

### plotting to see the trend for all different types of e

``` r
citi_effect %>% 
  ggplot(aes(x = weekdays, y = median_duration, group = year, color = month)) +
  geom_line() +
  facet_grid(year~month) + 
  labs(
    title = "Median Ride Duration by weekdays, month and year",
    x = "Weekdays",
    y = "Median Duration",
    color = "Month",
    group = "Year") +
  theme(legend.position = "bottom") +
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

<img src="p8105_hw3_jc6452_files/figure-gfm/unnamed-chunk-14-1.png" width="90%" />

``` r
citi %>% 
  ggplot(aes(x = rideable_type, y = duration))+
  geom_violin() + 
  facet_grid(month ~ member_casual) + 
  labs (
    title = "Ride Duration vs. Bike type Depending on Membership Status and Month",
    x = "Type of Bike",
    y = "Ride Duration") +
  theme_minimal()
```

<img src="p8105_hw3_jc6452_files/figure-gfm/unnamed-chunk-15-1.png" width="90%" />
